{% comment %}
  NUSENSE TryON Button Section
  This section can be added via the Theme Editor UI (no code editing required!)
  Add this file to: sections/nusense-tryon-button.liquid
{% endcomment %}

<div class="nusense-tryon-section">
  {% if section.settings.show_button %}
    <button 
      id="nusense-tryon-btn" 
      class="nusense-tryon-button {{ section.settings.button_style }}"
      style="
        {% if section.settings.button_width == 'full' %}width: 100%;{% endif %}
      "
    >
      {% if section.settings.show_icon %}
        <span>{{ section.settings.button_icon }}</span>
      {% endif %}
      {{ section.settings.button_text | default: 'Try Now' }}
    </button>
  {% endif %}
</div>

{% schema %}
{
  "name": "NUSENSE TryON Button",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_button",
      "label": "Show Try-On Button",
      "default": true
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Try Now"
    },
    {
      "type": "checkbox",
      "id": "show_icon",
      "label": "Show Icon",
      "default": true
    },
    {
      "type": "text",
      "id": "button_icon",
      "label": "Button Icon",
      "default": "âœ¨",
      "info": "Enter emoji or icon code"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "Button Style",
      "options": [
        {
          "value": "primary",
          "label": "Primary (Uses theme primary color)"
        },
        {
          "value": "secondary",
          "label": "Secondary (Uses theme secondary color)"
        },
        {
          "value": "outline",
          "label": "Outline (Uses theme accent color)"
        },
        {
          "value": "minimal",
          "label": "Minimal (Transparent with theme text color)"
        }
      ],
      "default": "primary",
      "info": "Button will automatically match your store's color palette"
    },
    {
      "type": "select",
      "id": "button_width",
      "label": "Button Width",
      "options": [
        {
          "value": "auto",
          "label": "Auto"
        },
        {
          "value": "full",
          "label": "Full Width"
        }
      ],
      "default": "auto"
    },
    {
      "type": "checkbox",
      "id": "match_theme_button",
      "label": "Match Theme Button Style",
      "default": true,
      "info": "Button will inherit the same styling as your theme's Add to Cart button"
    },
    {
      "type": "header",
      "content": "Widget Configuration"
    },
    {
      "type": "text",
      "id": "widget_url",
      "label": "Widget URL",
      "default": "https://try-this-look.vercel.app",
      "info": "Your deployed NUSENSE TryON widget URL"
    },
    {
      "type": "checkbox",
      "id": "enable_debug",
      "label": "Enable Debug Mode",
      "default": false
    }
  ],
  "presets": [
    {
      "name": "NUSENSE TryON Button",
      "category": "Custom"
    }
  ]
}
{% endschema %}

<style>
  .nusense-tryon-section {
    margin: 10px 0;
  }
  
  .nusense-tryon-button {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 16px;
    transition: all 0.2s ease;
    font-family: inherit;
    text-decoration: none;
    text-align: center;
    min-height: 44px;
    box-sizing: border-box;
  }
  
  .nusense-tryon-button:hover {
    transform: scale(1.02);
    opacity: 0.9;
  }
  
  .nusense-tryon-button:active {
    transform: scale(0.98);
  }
  
  /* Primary style - matches theme primary button */
  .nusense-tryon-button.primary {
    background: var(--color-button, var(--color-primary, #000));
    color: var(--color-button-text, var(--color-primary-contrast, #fff));
    border: 1px solid var(--color-button, var(--color-primary, #000));
  }
  
  .nusense-tryon-button.primary:hover {
    background: var(--color-button-hover, var(--color-primary-hover, #333));
    border-color: var(--color-button-hover, var(--color-primary-hover, #333));
  }
  
  /* Secondary style - matches theme secondary button */
  .nusense-tryon-button.secondary {
    background: var(--color-button-secondary, var(--color-secondary, #f8f9fa));
    color: var(--color-button-secondary-text, var(--color-secondary-contrast, #333));
    border: 1px solid var(--color-button-secondary-border, var(--color-border, #ddd));
  }
  
  .nusense-tryon-button.secondary:hover {
    background: var(--color-button-secondary-hover, var(--color-secondary-hover, #e9ecef));
    border-color: var(--color-button-secondary-hover, var(--color-secondary-hover, #ccc));
  }
  
  /* Outline style - matches theme accent */
  .nusense-tryon-button.outline {
    background: transparent;
    color: var(--color-accent, var(--color-primary, #000));
    border: 2px solid var(--color-accent, var(--color-primary, #000));
  }
  
  .nusense-tryon-button.outline:hover {
    background: var(--color-accent, var(--color-primary, #000));
    color: var(--color-accent-contrast, var(--color-primary-contrast, #fff));
  }
  
  /* Minimal style - transparent with theme text color */
  .nusense-tryon-button.minimal {
    background: transparent;
    color: var(--color-text, #333);
    border: none;
    box-shadow: none;
  }
  
  .nusense-tryon-button.minimal:hover {
    background: var(--color-background-hover, rgba(0,0,0,0.05));
  }
  
  /* Match theme button styling if enabled */
  {% if section.settings.match_theme_button %}
    .nusense-tryon-button {
      /* Inherit from theme's button styles */
      font-family: var(--font-button-family, inherit);
      font-size: var(--font-button-size, 16px);
      font-weight: var(--font-button-weight, 600);
      padding: var(--button-padding, 12px 24px);
      border-radius: var(--button-border-radius, 8px);
      text-transform: var(--button-text-transform, none);
      letter-spacing: var(--button-letter-spacing, normal);
    }
    
    /* Try to match common theme button classes */
    .nusense-tryon-button.primary {
      background: var(--btn-primary-bg, var(--color-primary, #000));
      color: var(--btn-primary-color, var(--color-primary-contrast, #fff));
      border: var(--btn-primary-border, 1px solid var(--color-primary, #000));
    }
    
    .nusense-tryon-button.secondary {
      background: var(--btn-secondary-bg, var(--color-secondary, #f8f9fa));
      color: var(--btn-secondary-color, var(--color-secondary-contrast, #333));
      border: var(--btn-secondary-border, 1px solid var(--color-border, #ddd));
    }
  {% endif %}
  
  @media (max-width: 768px) {
    .nusense-tryon-button {
      width: 100%;
      justify-content: center;
      min-height: 48px;
    }
  }
  
  /* Ensure button is accessible */
  .nusense-tryon-button:focus {
    outline: 2px solid var(--color-focus, #007acc);
    outline-offset: 2px;
  }
  
  .nusense-tryon-button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
  }
</style>

<script>
  // Initialize widget configuration
  window.NUSENSE_CONFIG = {
    widgetUrl: '{{ section.settings.widget_url | default: "https://try-this-look.vercel.app" }}',
    debug: {{ section.settings.enable_debug | default: false }},
    autoDetect: true
  };
  
  // Load widget script if not already loaded
  if (!document.querySelector('script[src*="nusense-tryon-widget.js"]')) {
    const script = document.createElement('script');
    script.src = '{{ section.settings.widget_url | default: "https://try-this-look.vercel.app" }}/nusense-tryon-widget.js';
    script.async = true;
    script.defer = true;
    document.head.appendChild(script);
  }
</script>
